function main(){if(window['COM_KAMILSARELO_DYNATRACE_TIMETRACKING_FORK_RUNNING']){console['log']('ERROR:\x20bookmarklet\x20is\x20already\x20running');return;}window['COM_KAMILSARELO_DYNATRACE_TIMETRACKING_FORK_RUNNING']=!![];console['log']('bookmarklet\x20called');var a='https://dynatrace.timecockpit.com';if(window['location']['origin']!==a){var b=document['createElement']('dummy');b['innerHTML']='\x09\x09\x09<div\x20style=\x22position:\x20fixed;\x20top:\x200;\x20bottom:\x200;\x20left:\x200;\x20right:\x200;\x20z-index:\x20999;\x20background-color:\x20rgba(0,\x200,\x200,\x200.66);\x20display:\x20grid;\x22>\x09\x09\x09\x09<div\x20style=\x22margin:\x20auto;\x20padding:\x2024px;\x20box-sizing:\x20border-box;\x20font-size:\x2024px;\x20background-color:\x20yellow;\x20border-radius:\x204px;\x20font-family:\x20Roboto,\x20\x27Segoe\x20UI\x27,\x20BlinkMacSystemFont,\x20system-ui,\x20-apple-system,\x20Arial,\x20Helvetica,\x20sans-serif;\x22>\x09\x09\x09\x09\x09...redirecting\x20to\x20'+a+'.\x20Run\x20the\x20bookmarklet\x20again\x20after\x20the\x20site\x20loaded.\x09\x09\x09\x09</div>\x09\x09\x09</div>';document['body']['appendChild'](b['querySelector']('div'));window['setTimeout'](function(){window['location']['href']=a;},0x3e8);}else{if(document['readyState']&&document['readyState']==='complete'){_['createContent']();}else{window['COM_KAMILSARELO_DYNATRACE_TIMETRACKING_FORK_RUNNING']=![];}}}var _=function(){'use strict';var a={};var b;var c=new Map();var d='done';a['createContent']=function(){var o='com_kamilsarelo_dynatrace_timetracking_css';var p='com_kamilsarelo_dynatrace_timetracking_html';function q(){[p,o]['forEach'](function(r){document['querySelectorAll']('#'+r)['forEach'](function(s){s['parentNode']['removeChild'](s);});});};q();(function(){return new Promise(function(r,s){var t=document['createElement']('link');t['id']=o;t['rel']='stylesheet';t['type']='text/css';t['href']='https://christian-fischer.github.io/com.dynatrace.timetracking.bookmarklet.css?q='+new Date()['getTime']();t['media']='all';t['onload']=function(){r();};document['head']['appendChild'](t);});}()['then'](function(){var r='com_kamilsarelo_dynatrace_timetracking_content';var s='com_kamilsarelo_dynatrace_timetracking_header';var t='com_kamilsarelo_dynatrace_timetracking_main';var u='com_kamilsarelo_dynatrace_timetracking_input';var v='com_kamilsarelo_dynatrace_timetracking_footer';var w='com_kamilsarelo_dynatrace_timetracking_footer_left';var x='com_kamilsarelo_dynatrace_timetracking_footer_right';var y='com_kamilsarelo_dynatrace_timetracking_select_type';var z='com_kamilsarelo_dynatrace_timetracking_action_book';var A='com_kamilsarelo_dynatrace_timetracking_action_clear';var B='com_kamilsarelo_dynatrace_timetracking_action_close';var C='com_kamilsarelo_dynatrace_timetracking_loader';var D=document['createElement']('dummy');D['innerHTML']='\x09\x09\x09\x09\x09<div\x20id=\x22'+p+'\x22>\x09\x09\x09\x09\x09\x09<div\x20id=\x22'+r+'\x22>\x09\x09\x09\x09\x09\x09\x09<div\x20id=\x22'+s+'\x22>\x09\x09\x09\x09\x09\x09\x09\x09<select\x20id=\x22'+y+'\x22\x20class=\x22filament-select-css\x22>\x09\x09\x09\x09\x09\x09\x09\x09\x09<option\x20value=\x22cd4f750b-85f8-41f8-b193-9c82e23f82eb\x22\x20selected=\x22selected\x22>Office</option>\x09\x09\x09\x09\x09\x09\x09\x09\x09<option\x20value=\x220ad94cf7-955c-45dc-b49e-20be0f449b75\x22>Home\x20Office</option>\x09\x09\x09\x09\x09\x09\x09\x09</select>\x09\x09\x09\x09\x09\x09\x09</div>\x09\x09\x09\x09\x09\x09\x09<div\x20id=\x22'+t+'\x22>\x09\x09\x09\x09\x09\x09\x09\x09<div\x20id=\x22'+u+'\x22\x20contenteditable=\x22true\x22>\x09\x09\x09\x09\x09\x09\x09\x09\x09&#xfeff;\x09\x09\x09\x09\x09\x09\x09\x09</div>\x09\x09\x09\x09\x09\x09\x09\x09<div\x20id=\x22'+C+'\x22>\x09\x09\x09\x09\x09\x09\x09\x09\x09<div\x20class=\x22spin-wrapper\x22>\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09<div\x20class=\x22spinner\x22>\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09</div>\x09\x09\x09\x09\x09\x09\x09\x09\x09</div>\x09\x09\x09\x09\x09\x09\x09\x09</div>\x09\x09\x09\x09\x09\x09\x09</div>\x09\x09\x09\x09\x09\x09\x09<div\x20id=\x22'+v+'\x22>\x09\x09\x09\x09\x09\x09\x09\x09<button\x20id=\x22'+z+'\x22\x20class=\x22pure-material-button-contained\x22>Book</button>\x09\x09\x09\x09\x09\x09\x09\x09<button\x20id=\x22'+A+'\x22\x20class=\x22pure-material-button-outlined\x22>Clear</button>\x09\x09\x09\x09\x09\x09\x09\x09<button\x20id=\x22'+B+'\x22\x20class=\x22pure-material-button-outlined\x22>Close</button>\x09\x09\x09\x09\x09\x09\x09</div>\x09\x09\x09\x09\x09\x09</div>\x09\x09\x09\x09\x09</div>';document['body']['appendChild'](D['querySelector']('div'));setTimeout(function(){document['getElementById'](u)['focus']();},0x0);document['getElementById'](u)['addEventListener']('paste',function(E){E['preventDefault']();var F=(E['originalEvent']||E)['clipboardData']['getData']('text/plain');document['execCommand']('insertText',![],F);});document['getElementById'](z)['onclick']=function(){var E=document['getElementById'](u);E['querySelectorAll']('*:not(br)')['forEach'](function(M){E['removeChild'](M);});var F=E['innerText'];if(F['trim']()['length']===0x0){return;}function G(M){[z,A,B]['forEach'](function(N){document['getElementById'](N)['disabled']=!M;});E['contentEditable']=M;E['focus']();document['getElementById'](C)['style']['visibility']=M?'hidden':'visible';}G(![]);var H=document['getElementById'](y);var I=H['options'][H['selectedIndex']]['value'];E['innerHTML']='';var J;var K=F['split'](/\r\n|\r|\n/g);var L=function(M){if(J){E['innerHTML']=(E['innerHTML']?E['innerHTML']+'<br>':'')+(M?'<span\x20class=\x22pill\x22\x20style=\x22background-color:\x20'+(M===d?'green':'red')+';\x22>'+M+'</span>':'')+J;E['scrollTop']=E['scrollHeight'];}if(K['length']>0x0){J=K['shift']();e(J,I,L);}else{G(!![]);var N=document['querySelector']('button[ng-click=\x22refresh()\x22]');if(N){N['click']();}}};setTimeout(function(){L();},0x0);};document['getElementById'](A)['onclick']=function(){var E=document['getElementById'](u);E['innerHTML']='';E['focus']();};document['getElementById'](B)['onclick']=function(){q();};document['onkeydown']=function(E){E=E||window['event'];if(E['keyCode']==0x1b){q();document['onkeydown']=undefined;}};window['COM_KAMILSARELO_DYNATRACE_TIMETRACKING_FORK_RUNNING']=![];}));};function e(o,p,q){o=o['trim']();if(!o){q();return;}var r=function(){if(!o||o['length']<=0x17||isNaN(o['charAt'](0x0))||'|'!==o['charAt'](0xa)||'|'!==o['charAt'](0x10)||'|'!==o['charAt'](0x16)){return;}var s=o['substr'](0x0,0xa);var t=o['substr'](0xb,0x5);var u=o['substr'](0x11,0x5);var v=o['indexOf']('|',0x17);if(v===-0x1){return;}var w=o['substring'](0x17,v);if(w===''){return;}var x=o['substr'](v+0x1);if(x===''){return;}{if('-'!==s['charAt'](0x4)||'-'!==s['charAt'](0x7)){return;}if(isNaN(s['charAt'](0x0))||isNaN(s['charAt'](0x1))||isNaN(s['charAt'](0x2))||isNaN(s['charAt'](0x3))||isNaN(s['charAt'](0x5))||isNaN(s['charAt'](0x6))||isNaN(s['charAt'](0x8))||isNaN(s['charAt'](0x9))){return;}var y=new Date()['getFullYear']();var z=parseInt(s['substr'](0x0,0x4),0xa);if(isNaN(z)||z<y||z>y){return;}var A=parseInt(s['substr'](0x5,0x2),0xa);if(isNaN(z)||A<0x1||A>0xc){return;}var B=parseInt(s['substr'](0x8,0x2),0xa);if(isNaN(z)||B<0x1||B>0x1f){return;}if(function(){var J=new Date();J['setFullYear'](z,A-0x1,B);return J['getFullYear']()!==z||J['getMonth']()!==A-0x1||J['getDate']()!==B;}()){return;}}{function J(M){return isNaN(M['charAt'](0x0))||isNaN(M['charAt'](0x1))||isNaN(M['charAt'](0x3))||isNaN(M['charAt'](0x4));}function K(M){return isNaN(M)||M<0x0||M>0x17;}function L(M){return isNaN(M)||M<0x0||M>0x3b;}if(':'!==t['charAt'](0x2)||':'!==u['charAt'](0x2)){return;}if(J(t)||J(u)){return;}var C=parseInt(t['substr'](0x0,0x2),0xa);var D=parseInt(u['substr'](0x0,0x2),0xa);if(K(C)||K(D)){return;}var E=parseInt(t['substr'](0x3,0x2),0xa);var F=parseInt(u['substr'](0x3,0x2),0xa);if(L(E)||L(F)){return;}if(C>D||C===D&&E>=F){return;}}var G=s+'T'+t+':00';var H=s+'T'+u+':00';var I=x;return{'jiraKey':w,'APP_BeginTime':G,'APP_EndTime':H,'APP_Description':I};}();if(r){r['USR_TimesheetTypeUuid']=p;f(r,q);}else{q('invalid');}};function f(o,p){function q(){o['APP_UserDetailUuid']=b;g(o,p);}if(b){q();return;}k('/shell/user')['then'](function(r){var s=JSON['parse'](r);if(s){if(s['useruuid']){b=s['useruuid'];q();return;}else{console['log']('ERROR:\x20no\x20useruuid\x20available');}}else{console['log']('ERROR:\x20on\x20JSON.parse()\x20in\x20queryUserId()');}p('error');})['catch'](function(r){console['log']('ERROR:\x20in\x20queryUserId()',r);p(r['status']||'error');});;}function g(o,p){k('/odata/APP_Timesheet'+'?$filter=(APP_BeginTime\x20eq\x20datetime\x27'+o['APP_BeginTime']+'\x27'+'\x20or\x20APP_EndTime\x20eq\x20datetime\x27'+o['APP_EndTime']+'\x27)'+'\x20and\x20APP_UserDetailUuid\x20eq\x20guid\x27'+o['APP_UserDetailUuid']+'\x27')['then'](function(q){var r=JSON['parse'](q);if(r&&r['value']){if(r['value']['length']>0x0){console['log']('ERROR:\x20APP_Timesheet\x20entity\x20with\x20equal\x20start-\x20('+o['APP_BeginTime']+')\x20and/or\x20end-time\x20('+o['APP_EndTime']+')\x20exists');p('exists');return;}else{h(o,p);return;}}else{console['log']('ERROR:\x20on\x20JSON.parse()\x20in\x20checkIfEntityWithEqualBeginOrEndTimeAlreadyExists()');}p('error');})['catch'](function(q){console['log']('ERROR:\x20in\x20checkIfEntityWithEqualBeginOrEndTimeAlreadyExists()',q);p(q['status']||'error');});}function h(o,p){function q(){var r=c['get'](o['jiraKey']);o['APP_TaskUuid']=r['APP_TaskUuid'];o['APP_ProjectUuid']=r['APP_ProjectUuid'];i(o,p);}if(c['has'](o['jiraKey'])){q();return;}k('/odata/APP_Task'+'?$filter=APP_Code\x20eq\x20\x27'+o['jiraKey']+'\x27'+'&$select=APP_TaskUuid,APP_ProjectUuid')['then'](function(r){var s=JSON['parse'](r);if(s&&s['value']){if(s['value']['length']>0x0){c['set'](o['jiraKey'],{'APP_TaskUuid':s['value'][0x0]['APP_TaskUuid'],'APP_ProjectUuid':s['value'][0x0]['APP_ProjectUuid']});q();return;}else{console['log']('ERROR:\x20no\x20APP_Task\x20entity\x20for\x20specified\x20Jira\x20key\x20('+o['jiraKey']+')\x20available');}}else{console['log']('ERROR:\x20on\x20JSON.parse()\x20in\x20queryTaskIdAndProjectIdForJiraKey()');}p('error');})['catch'](function(r){console['log']('ERROR:\x20in\x20queryTaskIdAndProjectIdForJiraKey()',r);p(r['status']||'error');});}function i(o,p){var q=JSON['stringify']({'APP_BeginTime':o['APP_BeginTime'],'APP_EndTime':o['APP_EndTime'],'APP_Description':o['APP_Description'],'APP_TaskUuid':o['APP_TaskUuid'],'APP_ProjectUuid':o['APP_ProjectUuid'],'APP_UserDetailUuid':o['APP_UserDetailUuid'],'USR_TimesheetTypeUuid':o['USR_TimesheetTypeUuid']});l('/odata/APP_Timesheet',q)['then'](function(r){p(d);})['catch'](function(r){console['log']('ERROR:\x20in\x20createEntity()',r);p(r['status']||'error');});}function j(o){m('/odata/APP_Timesheet(guid\x27'+o+'\x27)')['then'](function(p){console['log']('deleted\x20APP_Timesheet\x20entity\x20with\x20UUID:\x20'+o);})['catch'](function(p){console['log']('ERROR:\x20in\x20deleteEntity()',p);});}function k(o){return n(o);};function l(o,p){return n(o,'POST',p);};function m(o){return n(o,'DELETE');};function n(o,p,q){var r=new XMLHttpRequest();return new Promise(function(s,t){r['onreadystatechange']=function(){if(r['readyState']!==0x4)return;if(r['status']>=0xc8&&r['status']<0x12c){s(r['responseText']);}else{t({'status':r['status'],'statusText':r['statusText']});}};r['open'](p||'GET',o,!![]);r['setRequestHeader']('cache-control','no-cache');r['setRequestHeader']('cache-control','max-age=0');r['setRequestHeader']('pragma','no-cache');if(p==='POST'){r['setRequestHeader']('Content-Type','application/json;\x20charset=utf-8');r['send'](q);}else{r['send']();}});};return a;}();main();
//# sourceMappingURL=https://christian-fischer.github.io/com.dynatrace.timetracking.bookmarklet.js.map